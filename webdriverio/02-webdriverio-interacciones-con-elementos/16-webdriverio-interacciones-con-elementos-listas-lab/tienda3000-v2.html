<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda 3000 - v2.0</title>
    <style>
        body { font-family: sans-serif; color: #333; margin: 0; padding: 20px; }
        .contenedor { display: flex; gap: 20px; max-width: 1200px; margin: 0 auto; }
        .seccion-productos { flex: 2; }
        .seccion-carrito { flex: 1; border-left: 1px solid #ccc; padding-left: 20px; height: fit-content; }

        .lista-productos { display: block; }
        .tarjeta-producto { border: 1px solid #eee; margin-bottom: 15px; padding: 15px; background: white; }

        .titulo-producto { font-weight: bold; margin-bottom: 5px; font-size: 1em; }
        .precio-producto { color: #555; display: block; margin-bottom: 10px; font-weight: normal; font-size: 1em; }

        button.boton-agregar {
            background: #f0f0f0;
            border: 1px solid #ccc;
            padding: 5px 10px;
            cursor: pointer;
            display: inline-block;
            font-size: 14px;
            color: #333;
            text-decoration: none;
            width: auto;
            border-radius: 0;
            transition: none;
        }
        button.boton-agregar:hover { background: #e0e0e0; }

        .articulo-carrito { padding: 5px 0; border-bottom: 1px solid #eee; display: block; }
        .contenido-articulo-carrito { display: flex; justify-content: space-between; align-items: center; }

        .boton-eliminar {
            cursor: pointer;
            font-size: 12px;
            color: red;
            text-decoration: underline;
            border: none;
            background: none;
            padding: 0;
            margin-left: 10px;
        }
        .boton-eliminar:hover { background: none; color: red; }

        .total-carrito { margin-top: 20px; font-weight: normal; font-size: 1em; }

        .boton-pedido {
            padding: 5px 10px;
            cursor: pointer;
            background: buttonface;
            color: buttontext;
            border: 1px solid #888;
            margin-top: 20px;
            font-size: 13px;
            width: auto;
        }
        .boton-pedido:hover { background: #ddd; }

        .mensaje-carrito-vacio { color: #333; }
    </style>
</head>
<body>

    <header style="margin-bottom: 20px;">
        <h1>Tienda 3000</h1>
    </header>

    <div class="contenedor">
        <div class="seccion-productos" data-test="lista-productos">
            <h3>Productos</h3>
            <div class="lista-productos">

            </div>
        </div>

        <div class="seccion-carrito" data-test="contenedor-carrito">
            <h3>Cesta</h3>
            <div id="articulos-carrito" data-test="lista-articulos-carrito">
                <div class="mensaje-carrito-vacio" data-test="mensaje-carrito-vacio">Carrito vacío</div>
            </div>

            <br>

            <div class="total-carrito">
                <span>Total: </span>
                <span id="cantidad-total-carrito" data-test="precio-total-carrito">0</span>
            </div>

            <br>
            <button class="boton-pedido" data-test="boton-pedido">Realizar pedido</button>
        </div>
    </div>

    <script>
        const productos = [
            { id: 1, nombre: 'MacBook Mini', precio: 999.00 },
            { id: 2, nombre: 'Nothing Phone 3', precio: 699.00 },
            { id: 3, nombre: 'Auriculares Sony WH-1000XM5', precio: 299.00 },
            { id: 4, nombre: 'Monitor Xiaomi 34"', precio: 399.00 }
        ]

        let carrito = [
            productos[0],
            productos[1]
        ]

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex)
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array
        }

        function renderizarProductos() {
            const contenedorProductos = document.querySelector('.lista-productos')
            contenedorProductos.innerHTML = ''

            const shuffledProductos = shuffle([...productos])

            shuffledProductos.forEach(producto => {
                const productoItem = document.createElement('article')
                productoItem.className = 'tarjeta-producto'
                productoItem.dataset.test = 'articulo-producto'
                const randomId = 'prod-' + Math.random().toString().substr(2, 5)
                productoItem.id = randomId

                productoItem.innerHTML = `
                    <div class="titulo-producto">${producto.nombre}</div>
                    <div class="precio-producto">$${producto.precio.toFixed(2)}</div>
                    <button class="boton-agregar" data-id-producto="${producto.id}">Añadir al carrito</button>
                `
                contenedorProductos.appendChild(productoItem)
            })

            contenedorProductos.querySelectorAll('.boton-agregar').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.getAttribute('data-id-producto'))
                    agregarAlCarrito(id)
                })
            })
        }

        function renderizarCarrito() {
            const contenedorCarrito = document.getElementById('articulos-carrito')
            const elementoTotal = document.getElementById('cantidad-total-carrito')

            if (carrito.length === 0) {
                contenedorCarrito.innerHTML = '<div class="mensaje-carrito-vacio" data-test="mensaje-carrito-vacio">Carrito vacío</div>'
                elementoTotal.textContent = '0'
                return
            }

            contenedorCarrito.innerHTML = ''
            let total = 0

            carrito.forEach((articulo, indice) => {
                total += articulo.precio
                const elementoArticulo = document.createElement('div')
                elementoArticulo.className = 'articulo-carrito'
                elementoArticulo.setAttribute('data-test', 'articulo-carrito')
                elementoArticulo.innerHTML = `
                    <div class="contenido-articulo-carrito">
                        <span>${articulo.nombre} - ${articulo.precio}</span>
                        <button class="boton-eliminar" onclick="quitarDelCarrito(${indice})" data-test="boton-quitar-articulo">Quitar</button>
                    </div>
                `;
                contenedorCarrito.appendChild(elementoArticulo)
            })

            elementoTotal.textContent = `${total}`
        }

        function agregarAlCarrito(idProducto) {
            const producto = productos.find(p => p.id === idProducto)
            if (producto) {
                carrito.push(producto)
                renderizarCarrito()
            }
        }

        window.quitarDelCarrito = function(indice) {
            carrito.splice(indice, 1)
            renderizarCarrito()
        }

        document.querySelectorAll('[data-test="boton-agregar-al-carrito"]').forEach(boton => {
            boton.addEventListener('click', (e) => {
                const id = parseInt(e.target.getAttribute('data-id-producto'))
                agregarAlCarrito(id)
            })
        })

        document.querySelector('[data-test="boton-pedido"]').addEventListener('click', () => {
            if (carrito.length > 0) {
                alert('Procesando pedido...')
                carrito = []
                renderizarCarrito()
            } else {
                alert('No hay productos')
            }
        })

        renderizarProductos()
        renderizarCarrito()
    </script>
</body>
</html>
